<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Usuwanie emoji przed obrazkiem</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-card {
            width: 300px;
            height: 200px;
            margin: 20px auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background-color: #f9f9f9;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover { background: #0056b3; }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            text-align: center;
        }
        .info { background: #e7f3ff; border-left: 4px solid #007bff; }
        .success { background: #d4edda; color: #155724; font-weight: bold; }
        h1 { color: #333; }
        .demo-box {
            background: #fff3cd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test usuwania emoji</h1>
        
        <div class="info status">
            <strong>Test weryfikuje:</strong><br>
            Czy emoji ‚è≥ znika PRZED pokazaniem obrazka<br>
            (nie powinno byƒá widoczne razem z grafikƒÖ)
        </div>

        <div class="demo-box">
            <strong>Nowy mechanizm:</strong>
            <ol>
                <li>Poka≈º emoji ‚è≥ (≈Çadowanie)</li>
                <li>Usu≈Ñ emoji NATYCHMIAST gdy URL gotowy</li>
                <li>Poczekaj a≈º obrazek siƒô za≈Çaduje</li>
                <li>Poka≈º obrazek (bez emoji!)</li>
            </ol>
        </div>

        <button id="testOldWay">Test STARY spos√≥b (problem)</button>
        <button id="testNewWay">Test NOWY spos√≥b (poprawiony)</button>
        <button id="reset">Reset</button>

        <div class="test-card" id="testCard">‚è≥</div>
        
        <div id="status"></div>
    </div>

    <script>
        const card = document.getElementById('testCard');
        const statusDiv = document.getElementById('status');
        
        // Przyk≈Çadowy URL obrazka (szybki do za≈Çadowania)
        const imageUrl = 'https://image.pollinations.ai/prompt/a%20cute%20cat%2C%20photo?width=300&height=200&seed=123&model=flux&nologo=true&enhance=false';

        function reset() {
            card.style.backgroundImage = '';
            card.textContent = '‚è≥';
            card.style.fontSize = '2rem';
            statusDiv.innerHTML = '';
        }

        // STARY spos√≥b - pokazuje obrazek zanim usuwa emoji
        async function testOldWay() {
            reset();
            statusDiv.innerHTML = '<div class="info status">‚ö†Ô∏è STARY spos√≥b: Ustaw obrazek ‚Üí Usu≈Ñ emoji</div>';
            
            setTimeout(() => {
                // Ustaw obrazek OD RAZU
                card.style.backgroundImage = `url(${imageUrl})`;
                
                // Potem asynchronicznie usu≈Ñ emoji (mo≈ºe byƒá za p√≥≈∫no!)
                const img = new Image();
                img.onload = () => {
                    card.textContent = ''; // Usu≈Ñ emoji PO za≈Çadowaniu
                    card.style.fontSize = '';
                    statusDiv.innerHTML = '<div class="success status">‚ö†Ô∏è PROBLEM: Emoji mog≈Ço byƒá widoczne razem z obrazkiem przez chwilƒô!</div>';
                };
                img.src = imageUrl;
            }, 1000);
        }

        // NOWY spos√≥b - usuwa emoji PRZED pokazaniem obrazka
        async function testNewWay() {
            reset();
            statusDiv.innerHTML = '<div class="info status">‚úÖ NOWY spos√≥b: Usu≈Ñ emoji ‚Üí Poczekaj na obrazek ‚Üí Poka≈º obrazek</div>';
            
            setTimeout(() => {
                // NAJPIERW usu≈Ñ emoji
                card.textContent = '';
                card.style.fontSize = '';
                
                // POTEM poczekaj a≈º obrazek siƒô za≈Çaduje
                const img = new Image();
                img.onload = () => {
                    // Dopiero teraz poka≈º obrazek
                    card.style.backgroundImage = `url(${imageUrl})`;
                    card.textContent = ''; // Podw√≥jna pewno≈õƒá
                    statusDiv.innerHTML = '<div class="success status">‚úÖ SUKCES: Emoji zniknƒô≈Ço PRZED pokazaniem obrazka!</div>';
                };
                img.src = imageUrl;
            }, 1000);
        }

        document.getElementById('testOldWay').addEventListener('click', testOldWay);
        document.getElementById('testNewWay').addEventListener('click', testNewWay);
        document.getElementById('reset').addEventListener('click', reset);
    </script>
</body>
</html>
